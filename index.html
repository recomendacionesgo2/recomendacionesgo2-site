<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Recomendaciones Go2 — Productos probados y de confianza</title>
<meta name="description" content="Guía práctica con productos probados por Go2: herramientas, hogar, impresión 3D y más. Recomendaciones honestas basadas en uso real."/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link href="https://fonts.gstatic.com" rel="preconnect" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>

<style>
  :root{
    --ink:#111827; --muted:#6b7280; --bg:#ffffff; --panel:#f7f7f7; --beige:#cbb682; --ring:#e5e7eb; --beige-soft:#F9F6F0;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  [id]{ scroll-margin-top: 70px; }
  @media (max-width:1024px){ [id]{ scroll-margin-top:60px } }
  @media (max-width:640px){ [id]{ scroll-margin-top:56px } }

  body{margin:0;color:var(--ink);background:var(--bg);font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;}

  /* ====== HEADER ====== */
  header{position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--ring);}
  .container{max-width:1120px;margin:0 auto;padding:18px 20px}
  .row{display:flex;align-items:center;gap:18px}
  .brand{font-family:Montserrat,system-ui,sans-serif;font-weight:700;font-size:22px}

  nav{margin-left:auto;display:flex;gap:26px;align-items:center;font-weight:600;letter-spacing:.2px}
  nav a{position:relative;color:var(--ink);text-decoration:none}
  nav a::after{
    content:""; position:absolute; left:0; bottom:-6px; width:100%; height:2px; background:var(--beige);
    transform:scaleX(0); transform-origin:left; transition:transform .3s ease;
  }
  nav a:hover::after, nav a.active::after{ transform:scaleX(1) }

  /* Hamburguesa */
  .menu-toggle{
    display:none; margin-left:auto; width:38px; height:38px; border:1px solid var(--ring); border-radius:8px; background:#fff; cursor:pointer;
  }
  .menu-toggle span, .menu-toggle::before, .menu-toggle::after{
    content:""; display:block; height:2px; background:#111827; margin:8px 9px; border-radius:2px;
  }
  .menu-toggle::before{ margin-top:10px }
  .menu-toggle::after{ margin-top:-6px }

  /* Menú responsive */
  @media (max-width:820px){
    nav{ display:none }
    .menu-toggle{ display:block }
    .mobile-nav{
      position:fixed; inset:56px 0 0 0; background:#fff; border-top:1px solid var(--ring);
      display:none; flex-direction:column; padding:14px 18px; gap:12px; z-index:45;
    }
    .mobile-nav a{ padding:10px 2px; font-weight:700; text-decoration:none; color:var(--ink); border-bottom:1px solid #f1f1f1 }
    .mobile-nav.open{ display:flex }
  }

  /* ====== TIPOGRAFÍA + BOTONES ====== */
  h1,h2,h3{font-family:Montserrat,system-ui,sans-serif;margin:0}
  .label{font-size:12px;letter-spacing:.15em;color:#555;}
  .btn-outline{background:#fff;border:1px solid var(--ink);padding:10px 14px;border-radius:8px;font-weight:700;text-decoration:none;color:var(--ink)}
  .btn-primary{background:var(--beige);color:#fff;padding:12px 18px;border-radius:10px;font-weight:800;text-decoration:none;display:inline-block}

  /* ====== HERO ====== */
  .hero-top{padding:36px 20px 36px;text-align:center}
  .hero-top h1{font-size:clamp(26px,6.2vw,44px); line-height:1.15; margin:10px 0 16px}

  /* ====== BLOQUE 5 ESTRELLAS (centrado) ====== */
  .band{background:#fafafa;border-top:1px solid var(--ring);border-bottom:1px solid var(--ring)}
  #destacado .wrap{max-width:1120px;margin:0 auto;padding:32px 20px}
  #destacado .eyebrow{font-size:13px;letter-spacing:.18em;color:var(--beige);font-weight:800;text-align:center;margin-bottom:6px}
  #destacado h2{font-size:clamp(24px,4.2vw,40px);font-weight:800;line-height:1.15;text-align:center;margin:0 0 14px}
  #destacado p{max-width:820px;margin:0 auto 18px;color:#4b5563;text-align:center}
  #destacado .hero-frame{width:min(820px,100%);margin:0 auto 10px;border-radius:10px;overflow:hidden;background:#fff}
  #destacado .hero-frame img{display:block;width:100%;height:auto;aspect-ratio:4/3;object-fit:cover}
  #destacado .controls{display:flex;justify-content:center;gap:.6rem;margin:8px 0 14px}
  #destacado .controls button{background:#fff;border:1px solid #d1d5db;color:#374151;width:36px;height:36px;border-radius:8px;cursor:pointer;font-weight:700}
  #destacado .cta{display:flex;justify-content:center}
  #destacado .cta .btn-primary{font-size:16px}

  /* ====== SECCIONES ====== */
  .section{max-width:1120px;margin:0 auto;padding:36px 20px}
  .section h3{font-size:clamp(22px,3.2vw,32px);margin:4px 0 16px}

  .criteria{background:#f6f6f6;border-top:1px solid var(--ring);border-bottom:1px solid var(--ring)}
  .criteria .inner{max-width:960px;margin:0 auto;padding:36px 20px;text-align:center}
  .criteria ul{list-style:none;padding:0;margin:12px auto;max-width:720px;color:#485260}
  .criteria li{margin:6px 0}

  .social-purpose{background:var(--beige-soft);border-top:1px solid var(--ring)}
  .social-purpose .inner{max-width:920px;margin:0 auto;padding:32px 20px}
  .social-purpose h3{margin-bottom:8px}

  footer{border-top:1px solid var(--ring);background:#fbfbfb}
  .foot{max-width:1120px;margin:0 auto;padding:28px 20px 48px;color:#6b7280}

  /* ====== FICHAS ====== */
  .cards{display:grid;gap:22px;grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:960px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media (max-width:640px){.cards{grid-template-columns:1fr}}

  .card{background:#fff;border:1px solid var(--ring);border-radius:10px;overflow:hidden}
  .thumb{width:100%;height:auto;aspect-ratio:1/1;object-fit:cover;display:block}
  .pad{padding:16px}
  .card h4{font-size:18px;margin:4px 0}
  .sub{color:var(--muted);font-size:14px}
  .buy{display:inline-block;margin-top:10px;background:#111827;color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700}

  /* Estrellas */
  .stars{position:relative;width:110px;height:20px}
  .stars::before{content:"★★★★★";letter-spacing:2px;font-size:18px;line-height:20px;color:#d1d5db}
  .stars::after{content:"★★★★★";letter-spacing:2px;font-size:18px;line-height:20px;color:#cbb682;position:absolute;inset:0;width:var(--fill,0%);overflow:hidden;white-space:nowrap}
  .stars small{margin-left:8px;color:#6b7280;font-size:12px;vertical-align:2px}

  /* Texto completo siempre visible */
  .card a.why{ display:none !important; }
  .card .reason{
    display:block !important; margin-top:12px; border:1px solid var(--ring); border-radius:8px; padding:10px 12px; background:#fff;
    white-space:pre-wrap; word-break:break-word; max-height:none !important; overflow:visible !important;
  }

  /* Barra sticky búsqueda */
  .products-toolbar{ position:sticky; top:82px; z-index:15; background:var(--bg); border-bottom:1px solid var(--ring); margin:8px 0 18px; padding:10px 0; }
  .products-toolbar .search-wrap{ max-width:460px; }
  #productSearch{ width:100%; padding:12px 14px; border:1px solid var(--ring); border-radius:8px; font:inherit; }
  .suggestions{ display:none; position:absolute; margin-top:6px; max-width:460px; background:#fff; border:1px solid var(--ring); border-radius:8px; box-shadow:0 4px 18px rgba(0,0,0,.08); list-style:none; padding:6px 0; }
  .suggestions li{ padding:10px 12px; cursor:pointer; display:flex; gap:8px; align-items:center; }
  .suggestions li:hover{ background:#f9fafb; }
  .suggestions .title{ font-weight:600; }
  .suggestions .sub{ color:var(--muted); font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:320px; }
  .is-hidden{ display:none !important; }

  /* ====== MODAL + TOAST ====== */
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.45); z-index:60; padding:16px; }
  .modal.open{ display:flex }
  .modal .sheet{ width:min(680px,92vw); max-height:82vh; background:#fff; border-radius:12px; overflow:auto; box-shadow:0 10px 40px rgba(0,0,0,.25) }
  .modal .close{ position:absolute; top:12px; right:12px; background:#fff; border:1px solid var(--ring); border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:700 }
  .modal .sheet img.thumb{ width:100%; height:auto; border-bottom:1px solid var(--ring); object-fit:cover; aspect-ratio:16/9; max-height:40vh }
  .modal .sheet .pad{ padding:16px }

  .toast{ position:fixed; right:20px; bottom:20px; background:#111827; color:#fff; padding:10px 14px; border-radius:10px;
          box-shadow:0 8px 24px rgba(0,0,0,.25); opacity:0; transform:translateY(10px);
          transition:opacity .25s ease, transform .25s ease; z-index:70; pointer-events:none; font-size:14px; }
  .toast.show{ opacity:1; transform:translateY(0); }

  /* Ajustes móviles generales */
  @media (max-width:640px){
    .container{ padding:16px }
    .section{ padding:28px 16px }
    #destacado .wrap{ padding:24px 16px }
    .products-toolbar{ top:64px }
  }
</style>
</head>

<body>
<header>
  <div class="container row">
    <div class="brand">Recomendaciones Go2</div>

    <!-- NAV DESKTOP -->
    <nav aria-label="Secciones del sitio">
      <a class="active" href="#inicio">INICIO</a>
      <a href="#productos">PRODUCTOS</a>
      <a href="#acerca">PROPÓSITO</a>
      <a href="#quien">QUIÉN RECOMIENDA</a>
      <a href="#contacto">CONTACTO</a>
    </nav>

    <!-- Botón hamburguesa -->
    <button class="menu-toggle" aria-label="Abrir menú"></button>
  </div>

  <!-- NAV MÓVIL -->
  <div class="mobile-nav" id="mobileNav" aria-label="Menú móvil">
    <a href="#inicio">INICIO</a>
    <a href="#productos">PRODUCTOS</a>
    <a href="#acerca">PROPÓSITO</a>
    <a href="#quien">QUIÉN RECOMIENDA</a>
    <a href="#contacto">CONTACTO</a>
  </div>
</header>

<main id="inicio">
  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- HERO -->
  <section class="hero-top">
    <div class="label">RECOMENDACIONES DE CALIDAD</div>
    <h1>Productos probados y recomendados</h1>
    <a class="btn-primary" href="#productos">VER PRODUCTOS</a>
  </section>

  <!-- 5 ESTRELLAS, centrado -->
  <div class="band" id="destacado">
    <div class="wrap">
      <div class="eyebrow">SECCIÓN 5 ESTRELLAS</div>
      <h2>Productos seleccionados con cuidado</h2>
      <p>En Recomendaciones Go2, comparto mis experiencias con productos de calidad que he probado personalmente. Mi objetivo es facilitarte la elección de herramientas, artículos para el hogar y tecnología que realmente valen la pena. En la imagen de abajo irán alternando los productos que han conseguido <strong>5 estrellas</strong>.</p>

      <div class="hero-frame">
        <img id="hero-featured-img" alt="Producto destacado" src="/images/uploads/hero-5estrellas.png"/>
      </div>

      <div class="controls">
        <button type="button" id="prevFeat" aria-label="Anterior">‹</button>
        <button type="button" id="nextFeat" aria-label="Siguiente">›</button>
      </div>

      <div class="cta">
        <a class="btn-primary" id="btnDestacado" href="#worx-destacado">Ver producto destacado</a>
      </div>
    </div>
  </div>

  <!-- CRITERIOS -->
  <section class="criteria" aria-label="Criterios de recomendación">
    <div class="inner">
      <h3>Criterios de recomendación</h3>
      <p>Cada producto ha sido probado durante un uso mínimo de <strong>30 días</strong>.</p>
      <ul>
        <li>• Prestaciones y calidad percibida en el uso real.</li>
        <li>• Respuesta del proveedor o de Amazon ante dudas o incidencias.</li>
        <li>• Duración de la batería (si aplica), robustez, peso y precio.</li>
      </ul>
      <p><strong>Solo publico los productos que realmente considero buenos</strong> —no hago listas de “malos”— y las valoraciones van de <strong>4 a 5 estrellas</strong> según la experiencia real de uso.</p>
    </div>
  </section>

  <!-- PRODUCTOS -->
  <section id="productos" class="section" aria-label="Productos">
    <div class="label" style="color:var(--beige);font-weight:800;letter-spacing:.18em">RECOMENDACIONES DE CALIDAD</div>
    <h3>Descubre productos que valen la pena</h3>

    <div class="products-toolbar" aria-label="Barra de búsqueda">
      <div class="search-wrap">
        <input id="productSearch" type="search" placeholder="Buscar productos (mín. 3 letras)…" autocomplete="off" aria-label="Buscar productos" />
        <ul id="searchSuggestions" class="suggestions" role="listbox" aria-label="Sugerencias"></ul>
      </div>
    </div>

    <p id="emptyProductsMsg" style="text-align:center;color:#6b7280;margin:24px 0 8px;font-size:14px">
      Aún no hay productos. Añade el primero desde <a href="/admin" style="color:#6b7280;text-decoration:underline">/admin</a>.
    </p>

    <div class="cards" id="productCards"></div>
  </section>

  <!-- PROPÓSITO -->
  <section id="acerca" class="social-purpose" aria-label="Transparencia y propósito social">
    <div class="inner" style="font-size:18px;line-height:1.6;color:#374151">
      <h3>Transparencia y propósito social</h3>
      <p>La cuenta de afiliado de Amazon pertenece a la <strong>Asociación Go2</strong>, y los ingresos generados se destinan íntegramente a financiar proyectos sociales, materiales educativos y acciones de sostenibilidad.</p>
      <p><strong>¿Por qué apoyarnos a través de Amazon?</strong><br/>Cada vez que adquieres un producto desde nuestros enlaces, una parte se destina a los programas solidarios de la Asociación Go2, <em>sin coste adicional para ti</em>.</p>
    </div>
  </section>

  <!-- QUIÉN RECOMIENDA -->
  <section id="quien" class="section" aria-label="Quién recomienda" style="background:#F9F6F0;">
    <div class="container" style="max-width:920px;margin:0 auto;">
      <h3 style="font-size:32px;margin:8px 0 12px">Quién recomienda</h3>
      <div class="prose" style="font-size:18px;line-height:1.6;color:#374151">
        <p><strong>Sobre Sebastián Ferragut</strong></p>
        <p>Soy el responsable de probar, comparar y seleccionar cada producto que aparece en <strong>Recomendaciones Go2</strong>. Desde mi trabajo en primera línea en los distintos departamentos de la <strong>Asociación Go2</strong> —reformas, impresión 3D, sostenibilidad y proyectos técnicos— utilizo personalmente cada herramienta, material o dispositivo antes de recomendarlo.</p>
        <p>Mi objetivo es <strong>recomendar solo productos</strong> que hayan demostrado buen rendimiento, durabilidad y servicio posventa, tanto en el ámbito profesional como doméstico. Aquí encontrarás desde materiales de construcción y herramientas, hasta filamentos 3D, electrodomésticos o soluciones que usamos en las propias obras y proyectos de Go2.</p>
        <p><strong>Solo publico aquello que realmente funciona y que he probado personalmente.</strong></p>
      </div>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="section" aria-label="Contacto">
    <h3>Contacto</h3>
    <div class="contact" style="max-width:680px;margin:16px auto 0;padding:20px;background:#fff;border:1px solid var(--ring);border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.03)">
      <p class="note" style="color:#4b5563">¿Tienes dudas o sugerencias? Envíanos tu mensaje a través de este formulario. Las respuestas pueden tardar hasta <strong>72 horas</strong>.</p>
      <form name="contact" method="POST" data-netlify="true" action="/?success=1">
        <input type="hidden" name="form-name" value="contact"/>
        <div class="field" style="display:flex;flex-direction:column;gap:6px;margin:10px 0">
          <label for="name" style="font-weight:600">Nombre</label>
          <input id="name" name="name" required style="padding:12px 14px;border:1px solid var(--ring);border-radius:8px;font:inherit"/>
        </div>
        <div class="field" style="display:flex;flex-direction:column;gap:6px;margin:10px 0">
          <label for="email" style="font-weight:600">Correo electrónico</label>
          <input id="email" type="email" name="email" required style="padding:12px 14px;border:1px solid var(--ring);border-radius:8px;font:inherit"/>
        </div>
        <div class="field" style="display:flex;flex-direction:column;gap:6px;margin:10px 0">
          <label for="message" style="font-weight:600">Mensaje</label>
          <textarea id="message" rows="5" name="message" required style="padding:12px 14px;border:1px solid var(--ring);border-radius:8px;font:inherit"></textarea>
        </div>
        <button class="submit btn-primary" type="submit" style="border:none;cursor:pointer">Enviar mensaje</button>
      </form>
      <p id="ok" style="display:none;margin-top:10px;color:#065f46;font-weight:600">Gracias por tu mensaje. Te responderemos en un plazo máximo de 72 horas.</p>
    </div>
  </section>

  <footer><div class="foot"><p>© <span id="year"></span> Recomendaciones Go2 — por Sebastián Ferragut</p></div></footer>
</main>

<!-- MODAL -->
<div id="productModal" class="modal" aria-hidden="true">
  <div class="sheet"></div>
  <button type="button" class="close" aria-label="Cerrar">✕</button>
</div>

<script>
  // Año y estado del formulario
  document.getElementById('year').textContent = new Date().getFullYear();
  if (new URLSearchParams(location.search).get('success') === '1'){
    const ok = document.getElementById('ok'); if(ok) ok.style.display = 'block';
  }

  // Menú móvil
  (function(){
    const btn = document.querySelector('.menu-toggle');
    const panel = document.getElementById('mobileNav');
    if(!btn || !panel) return;
    btn.addEventListener('click', ()=> panel.classList.toggle('open'));
    panel.querySelectorAll('a').forEach(a => a.addEventListener('click', ()=> panel.classList.remove('open')));
  })();

  // Resaltado nav al hacer scroll
  (function(){
    const navLinks = document.querySelectorAll('header nav a[href^="#"], .mobile-nav a[href^="#"]');
    const map = {};
    navLinks.forEach(a => {
      const id = a.getAttribute('href');
      const sec = document.querySelector(id);
      if (sec) map[id] = { links:[...document.querySelectorAll('a[href="'+id+'"]')], sec };
    });
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        const id = '#'+entry.target.id;
        if (!map[id]) return;
        if (entry.isIntersecting) {
          Object.values(map).forEach(({links}) => links.forEach(l=>l.classList.remove('active')));
          map[id].links.forEach(l=>l.classList.add('active'));
        }
      });
    }, { root:null, rootMargin:"-50% 0px -45% 0px", threshold:0 });
    Object.values(map).forEach(({sec}) => obs.observe(sec));
  })();

  // Fit imagen 5*
  (function(){
    var img = document.getElementById('hero-featured-img');
    if(!img) return;
    function applyFitMode() {
      var w = img.naturalWidth, h = img.naturalHeight;
      if(!w || !h) { setTimeout(applyFitMode, 50); return; }
      // (Se mantiene por compatibilidad; ahora usamos contain por CSS del frame)
    }
    img.addEventListener('load', applyFitMode);
    applyFitMode();
  })();

  // Render de productos + texto siempre visible (reason)
  (async function(){
    const grid = document.querySelector('.cards');
    const emptyNote = document.getElementById('emptyProductsMsg');
    try {
      const res = await fetch('/assets/products.json', { cache: 'no-store' });
      const items = res.ok ? await res.json() : [];
      if (!items.length) { if (emptyNote) emptyNote.style.display = 'block'; return; }
      if (emptyNote) emptyNote.style.display = 'none';

      items.forEach(p => {
        const art = document.createElement('article');
        art.className = 'card';
        art.id = `prod-${p.slug}`;
        art.innerHTML = `
          <img class="thumb" src="${p.image || ''}" alt="${p.title || ''}">
          <div class="pad">
            <h4>${p.title || ''}</h4>
            <div class="sub">${p.summary || ''}</div>
            <a class="buy" href="${p.buy_url || '#'}" target="_blank" rel="nofollow noopener">Comprar en Amazon</a>
            <div class="reason" id="why-${p.slug}">${p.why || ''}</div>
          </div>
        `;

        // Estrellas
        const fill = Math.max(0, Math.min(100, (p.rating/5)*100));
        const stars = document.createElement('div');
        stars.className = 'stars';
        stars.style.setProperty('--fill', fill + '%');
        const label = document.createElement('small');
        label.textContent = (p.rating || 0).toFixed(1);
        stars.appendChild(label);

        const pad = art.querySelector('.pad');
        const sub = art.querySelector('.sub');
        if (pad && sub) pad.insertBefore(stars, sub);

        grid && grid.appendChild(art);
      });

      window.__products = items;
    } catch (e) {
      console.error('Error cargando productos:', e);
      if (emptyNote) emptyNote.style.display = 'block';
    }
  })();

  // Carrusel destacado con modal + toast
  (function(){
    const img  = document.querySelector('#destacado .hero-frame img');
    const prev = document.getElementById('prevFeat');
    const next = document.getElementById('nextFeat');
    const btn  = document.getElementById('btnDestacado');
    if (!img || !prev || !next || !btn) return;

    function showToast(msg){
      const t = document.getElementById('toast');
      if(!t) return;
      t.textContent = msg; t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 2300);
    }

    function openModal(targetId){
      const m = document.getElementById('productModal');
      const sheet = m?.querySelector('.sheet');
      if(!m || !sheet) return;
      const card = document.getElementById(targetId);
      if(!card) return;

      sheet.innerHTML = card.innerHTML;
      m.classList.add('open'); m.setAttribute('aria-hidden','false');

      const close = m.querySelector('.close');
      const hide = ()=>{ m.classList.remove('open'); m.setAttribute('aria-hidden','true'); };
      close?.addEventListener('click', hide, { once:true });
      m.addEventListener('click', (e)=>{ if(e.target===m) hide(); }, { once:true });
    }

    function whenCardsReady(done){
      const grid = document.querySelector('.cards');
      if (!grid) return;
      const hasCard = !!grid.querySelector('article.card img.thumb');
      if (hasCard) { done(); return; }
      const mo = new MutationObserver(()=>{
        if (grid.querySelector('article.card img.thumb')) { mo.disconnect(); done(); }
      });
      mo.observe(grid, { childList:true, subtree:true });
    }

    whenCardsReady(()=>{
      const slides = [{ src:'/images/uploads/hero-5estrellas.png', targetId:null }];
      document.querySelectorAll('.cards article.card').forEach(card=>{
        const src = card.querySelector('img.thumb')?.getAttribute('src') || '';
        const id  = card.id || null;
        if (src && id) slides.push({ src, targetId:id });
      });

      let i = 0;
      function show(n){
        i = (n + slides.length) % slides.length;
        img.src = slides[i].src;
      }
      prev.addEventListener('click', (e)=>{ e.preventDefault(); if (slides.length>1) show(i-1); });
      next.addEventListener('click', (e)=>{ e.preventDefault(); if (slides.length>1) show(i+1); });

      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        const current = slides[i];
        if (!current.targetId){
          showToast('Para ver productos 5★, usa las flechas y selecciona uno.');
          return;
        }
        openModal(current.targetId);
      });

      show(0);
    });
  })();

  // Buscador
  (function(){
    const grid = document.querySelector('.cards');
    const input = document.getElementById('productSearch');
    const list  = document.getElementById('searchSuggestions');
    if(!grid || !input || !list) return;

    let index = [];
    const buildIndex = () => {
      index = Array.from(grid.querySelectorAll('article.card')).map(card=>{
        const id  = card.id || '';
        const ttl = (card.querySelector('h4')?.textContent || '').trim();
        const sub = (card.querySelector('.sub')?.textContent || '').trim();
        return { id, ttl, sub, card, haystack: (ttl + ' ' + sub).toLowerCase() };
      });
    };
    buildIndex();
    const mo = new MutationObserver(buildIndex);
    mo.observe(grid, { childList: true });

    const showAll = () => index.forEach(x => x.card.classList.remove('is-hidden'));
    const clearSuggestions = () => { list.innerHTML = ''; list.style.display = 'none'; };
    const renderSuggestions = (hits) => {
      if (!hits.length) { clearSuggestions(); return; }
      list.innerHTML = hits.slice(0,6).map(h => (
        `<li role="option" data-id="${h.id}">
           <span class="title">${h.ttl}</span>
           <span class="sub">${h.sub}</span>
         </li>`
      )).join('');
      list.style.display = 'block';
    };

    input.addEventListener('input', () => {
      const q = input.value.trim().toLowerCase();
      if (q.length < 3){ showAll(); clearSuggestions(); return; }
      const hits = index.filter(x => x.haystack.includes(q));
      index.forEach(x => x.card.classList.toggle('is-hidden', !hits.includes(x)));
      renderSuggestions(hits);
    });

    input.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){ input.value = ''; showAll(); clearSuggestions(); }
    });

    list.addEventListener('click', (e)=>{
      const li = e.target.closest('li[data-id]'); if(!li) return;
      const id = li.getAttribute('data-id'); const target = document.getElementById(id);
      if(target){ target.scrollIntoView({ behavior:'smooth', block:'start' }); clearSuggestions(); }
    });

    input.addEventListener('blur', ()=> setTimeout(clearSuggestions, 150));
  })();
</script>
</body>
</html>
